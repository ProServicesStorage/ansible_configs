---
- hosts: localhost
  connection: local
  become: true

  tasks:
  - name: install various macports
    community.general.macports:
      name: "{{ ports }}"
    vars:
      ports:
      - wget
      - htop
      - nmap
      - coreutils
      - ImageMagick7
      - ffmpeg
      - yt-dlp
      - gnupg2
      - tree
      - inetutils
      - go

  - name: users | mr | copy dotfiles
    tags: dotfiles,zsh
    copy:
      src: files/{{ item.src }}
      dest: /Users/mr/{{ item.dest }}
      owner: mr
      group: staff
      mode: 0600
    with_items:
      - { src: 'mac/aliases', dest: '.aliases' }
      - { src: 'mac/zshrc', dest: '.zshrc' }

  - name: copy mac settings
    tags: mac settings copy
    copy:
      src: files/mac/osx_settings
      dest: /Users/mr/osx_settings.sh

  - name: make osx settings script executable
    tags: mac settings permissions
    file: dest=/Users/mr/osx_settings.sh mode=+x

  - name: Run osx settings script
    tags: mac settings run
    script:
      cmd: /Users/mr/osx_settings.sh
